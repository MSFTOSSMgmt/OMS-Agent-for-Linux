[Unit]
Description=Operations Management Suite agent
After=network.target
Wants=omid.service

[Service]
Type=simple
User=omsagent
Group=omiusers
PIDFile=%RUN_DIR_WS%/omsagent.pid
EnvironmentFile=/etc/opt/microsoft/omsagent/omsagent.env
ExecStart=/opt/microsoft/omsagent/bin/omsagent \
  -d %RUN_DIR_WS%/omsagent.pid \
  -o %LOG_DIR_WS%/omsagent.log \
  -c %CONF_DIR_WS%/omsagent.conf \
  --no-supervisor
ExecStop=/bin/rm -f %RUN_DIR_WS%/omsagent.pid
KillMode=process
TimeoutStartSec=10
TimeoutStopSec=10
# Restart the process on a failure. Wait 3 seconds before attempting a restart.
Restart=on-failure
RestartSec=3
# Attempt restarts on failure up to 10 times within 120 seconds.
StartLimitInterval=120
StartLimitBurst=10

[Install]
WantedBy=multi-user.target
